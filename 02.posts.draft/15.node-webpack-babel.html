<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>15.node wp ba</title>
  <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/flint-style.css">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/dev-style.css">
</head>

<body>

<div class="container-fluid">
  <div class="ke-callout ke-callout-danger">
    <ul>
      <li>complete text</li>
      <li>pending read out-loud</li>
      <li>pending spelling</li>
      <li>pending punctuation</li>
    </ul>
  </div>

<p>This tutorial will show you how to use Webpack, Babel and ESLint. We will construct a minimal but working ... </p>

<h2>Prepare the machine</h2>
<p>I had some problems getting everything to work until I updated my VM. Although I didn't user the scientific method to prove the VM needed to be updated, it won't hurt to do so.</p>
<pre>$ sudo apt-get update</pre>
<div class="ke-callout ke-callout-warning">
  <p>Sometimes when you try to update right after booting  you will get a message like below. If you do, wait a few minutes and try again.</p>
  <pre>E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)<br>E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it?</pre>
</div>
<p class="ke-callout ke-callout-warning">With the next command you will see a message regarding 'grub-pc'. When prompted, check the box next to '/dev/sda' and click OK.</p>
<p>The process can take a while so be patient.</p>
<pre>$ sudo apt-get upgrade</pre>
<p>And then remove packages that are no longer in use if there are any.</p>
<pre>$ sudo apt-get autoremove</pre>

<h3>Curl</h3>
<p>Both NVM and Node use cURL as for installation. Check if it is installed.</p>
<pre>$ curl --version</pre>
<p>If not installed execute the following command.</p>
<pre>$ sudo apt install curl</pre>
<p>Then check the version again.</p>
<pre>$ curl --version</pre>

<h2>Install Node Version Manager (NVM)</h3>
<p>Install prequisites</p>
<pre>$ sudo apt-get isntall checkinstall<br>$ sudo apt-get install build-essential checkinstall</pre>
<p>Now install it</p>
<pre>$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.4/install.sh | bash</pre>
<p>Close and reopen terminal or it won't run</p>
<p>Verify that NVM has been installed.</p>
<pre>$ nvm -version</pre>

<h2>Create the Project</h2>
<p>If you have been following the series you will already have the directory ~/workspace, if not, create one now.</p>
<pre>mkdir ~/workspace/</pre>
<p>Then create a project directory</p>
<pre>$ cd ~/workspace<br>$ mkdir sample-project<br>$ cd sample-project</pre>
<p>Then add directors and files as follows:</p>
<pre>$ mkdir app<br>$ cd app<br>$ touch hello.js index.js number.js<br>$ cd ..<br>$ mkdir build<br>$ cd build<br>$ touch index.html<br>$ cd ..<br>$ touch webpack.config.js<br></pre>
<p>Make the contents of hello.js as as below.</p>
<pre>'use strict';

module.exports = function() {
  var element = document.createElement('h1');
  element.innerHTML = 'Hello world';
  return element;
};</pre>
<p>Make the contents of index.js as below.</p>
<pre>'use strict';

var helloElement = require('./hello');
var numElement = require('./number');

document.body.appendChild(helloElement());
document.body.appendChild(numElement());</pre>
<p>Make the contents of number.js as below.</p>
<pre>'use strict';

module.exports = function() {

  // es5
  var num = 0;
  var element = document.createElement('h2');

  // es6
  // let num = 0;
  // const element = document.createElement('h2');

  // rest of the code
  num += 5;
  element.innerHTML = 'number = ' + num;
  return element;
};</pre>

<p>Make the contents of index.html as below.</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Sample Project&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script src="app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<h2>Install Node.js Using NVM</h2>
<pre>$ nvm install node</pre>
<p>NVM will print out the Node version being used but you can check it with the below command.</p>
<pre>$ node --version</pre>
<h3>Initialize the project</h3>
<p>This process will create a package.json file which will track all NPM installations and provide other functionality as you will see later in the turtorial. <code>$npm init </code> will ask you a series of questions. For the purposes of this tutorial you can take the default for each question by pressing <kbd>Enter</kbd>.</p>
<pre>$ npm init</pre>


<h2>Adding Project Denpendancies</h2>
<div class="ke-callout ke-callout-info">
  <h4>Some NPM terms</h4>
  <table>
    <tr><td>i</td><td>Is short for <b>i</b>nstall.</td></tr>
    <tr><td>--save</td><td>Used to save a dependancy for use in the production distribution.</td></tr>
    <tr><td>--save-dev</td><td>Use to save a dependancy for use in development only.</td></tr>
  </table>
</div>
<p>We will install Webpack locally to the project. This way you can use different versions of Webpack for different projects if needed.</p>
<pre>$ npm i webpack --save-dev</pre>
<p>Make the contents of webpack.config.js as below.</p>
<pre>const path = require('path');

const PATHS = {
  app: path.join(__dirname, 'app'),
  build: path.join(__dirname, 'build')
};

module.exports = {
  context: __dirname + '/app',
  entry: {
    app: PATHS.app
  },
  output: {
    path: PATHS.build,
    filename: '[name].js'
  },
}; // module exports</pre>

<h3>Let's take it for a spin!</h3>
<p>There are many ways to launch Webpack which suit differt purposes or goals. We are going to add a script to package.json which will allow us to launch Webpack from the command line. In package.json, modify the 'scripts' secton to be as folllows, where the '-d' is for 'development'. Be careful to not miss the comma at the end of the 'test: "echo ..."' line.</p>
<pre>"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack -d"
  },</pre>
<p>Before running Webpack, observe that the /build directory is empty, then run this command.</p>
<pre>$ npm run build</pre>
<p>Take note that Webpack has created 2 files in the /build directory, app.js and app.js.map. The latter file is used for debugging but won't be useful to us until we install some additional modules below.</p>
<p>Open index.html in a browser to see your app in action.</p>

<p class="ke-callout ke-callout-info">Different browsers have different developer tools. In both Firefox and Chrome you press <kbd>F12</kbd> to activate developer tools. I'm using Firefox without Firebug and the next section will be easier to follow if you are using Firefox as well.</p>
<h3>Loader: source-map-loader</h3>
<p>Install source-map-loader</p>
<pre>$ npm i source-map-loader --save-dev</pre>
<p>Make the contents of the module.exports section in webpack.config.js as below.</p>
<pre>module.exports = {
  context: __dirname + '/app',
  entry: {
    app: PATHS.app
  },
  output: {
    path: PATHS.build,
    filename: '[name].js'
  },
  <span style="color:darkgreen"><b>module: {
    preLoaders: [
      {
        test: /\.js$/,
        loader: "source-map-loader"
      }
    ],
  }</b></span>
}; // module exports</pre>
<h3>Using Developer Tools</h3>
<p>You can now step through your code in Firefox developer tools.</p>
<p>With index.html open in a browser press F12 to activate the developer tools. Click on <button class="btn btn-default btn-xs">Debugger</button> and then <button class="btn btn-default btn-xs">Sources</button>.</p>
<p>Under Sources select number.js and in the left margin of the code window click on '14' to set a break point.</p>
<p>Press <kbd>F5</kbd> to refresh the page. Line 14 will be highlighted in the code window. Press the <button class="btn btn-default btn-xs">Step In</button> button to move to the next line of code.</p>
<p>Press the <button class="btn btn-default btn-xs">Click to resume</button> button to let code execution to exit step mode.</p>
<p>Click '14' in the margin to remove the break point.</p>


<h2>Babel</h2>
<p>Now lets add Babel to our project. Babel will ... </p>
<pre>$ npm i babel-core babel-loader babel-preset-es2015 --save-dev</pre>
<p>Change the contents of webpack.config.js as show below.</p>
<pre>module: {
    preLoaders: [
      {
        test: /\.js$/,
        loader: "source-map-loader"
      }
    ],
    <span style="color:darkgreen"><b>loaders: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
        query: {
          presets: ['es2015']
        }
      },
    ]</b></span>
  }, // module:</pre>
<h3>See Babel in Action</h3>
<p>Now let's look into the code to see what Babel is doing.</p>
<p>In number.js lines 6 & 7 under the line 5 'es5' comment use 'var' which is the es5 way to declare variables. Lines 10 & 11 under the line 9 'es6' comment use let and const respectively, which is new es6 syntax.</p>
<p>Next, look at app.js lines 84 - 90. You will see the same lines of the code with the es5 lines active and the es6 lines commented.</p>
<p>Now let's enable the es6 code. In number.js, comment out lines 10 & 11 and uncomment lines 6 & 7. Save number.js and rebuild the project using <code>$ npm run build</code>.</p>
<p>Once the build is complete, take a look in app.js lines 89 & 90. You will see that 'let' and 'const' have both been converted to 'var'. This is Babel in action converting es6 to es5.</p>

<h2>ESLint</h2>
<p>ESLint is a 'linter' for JavaScript. It will check your code for many different types of problems and save you a lot of time.</p>
<p>To install ESLint to your project, run this command.</p>
<h3>ESLint</h3>
<pre>$ npm i eslint eslint-loader --save-dev</pre>
<p>Make the contents of the 'preLoaders' section in webpack.config.js as below.</p>
<pre>preLoaders: [
      <span style="color:darkgreen"><b>{
        test: /\.js$/,
        loaders: ['eslint-loader'],
        exclude: /node_modules/,
        include: PATHS.app
      },</b></span>
      {
        test: /\.js$/,
        loader: "source-map-loader"
      }
    ],</pre>
<p>Add  '.eslintignore' & '.eslintrc' files to the project root. First make sure you current directory in terminal is ~/workspace/sample-project and then execute the below command.</p>
<pre>$ touch .eslintignore .eslintrc</pre>
<p>Make the contents of .eslintignore as follows.</p>
<pre>build/</pre>
<p>Make the contents of .eslintrc as follows.</p>
<pre>---
extends: eslint:recommended

ecmaFeatures:
  modules: true

env:
  es6: true
  browser: true
  node: true

parserOptions:
  script: module;

    ecmaVersion - set to 3, 5 (default), 6, or 7 to specify the version of ECMAScript you want to use.
    sourceType - set to "script" (default) or "module"

rules:
  indent: [2, 2] # 2 spaces indentation
  max-len: [2, 80, 4]
  quotes: [2, "single"]
  semi: [2, "always"]
  no-multiple-empty-lines: [2, {"max": 1}]

  brace-style: [2, "stroustrup"]
  comma-dangle: [2, "always-multiline"]
  comma-style: [2, "last"]
  computed-property-spacing: [2, "never"]
  dot-location: [2, "property"]

  one-var: [2, "never"]
  #no-var: [2]
  prefer-const: [2]
  no-bitwise: [2]

  object-curly-spacing: [2, "never"]
  array-bracket-spacing: [2, "never"]
  space-unary-ops: [2, {"words": true, "nonwords": false}]
  keyword-spacing: [2, {"after": true}]
  space-before-blocks: [2, "always"]
  space-before-function-paren: [2, "never"]
  space-in-parens: [2, "never"]
  spaced-comment: [2, "always"]
  no-console: [0]
  no-underscore-dangle: [1]
</pre>
<p>Now rebuild the project. Unless you made a change that doesn't conform to ESLint's rules, nothing different will happen. Let's make two changes to number.js so we can see ESLint in action.</p>
<p>On line 11 change 'const' to 'let'.</p>
<p>On line 14 remove the semicolon from the end of the line.</p>
<p>Rebuild the project and you will see ESLint recommend you use 'const' instead of 'let' and point out the missing semicolor. Note that both are considered an 'error' and the project build was terminated. Also note that ESLint is running before Babel replaces the 'let' & 'const' with 'var' so it is checking es6 syntax, not es5.</p>
<p>Put the 2 changed lines back the way they were.</p>

<h2>Production Build</h2>
<p>In a more full-featured Webpack implementation you would use separate Webpack configuration files do that tasks only needed for a development build, like including a source map, didn't run. For our simple implementation you can make a production build by editing package.json.<p>
<p>In package.json, change the "build" line to have -p instead of -d as shown.</p>
<pre>"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    <span style="color:darkgreen"><b>"build": "webpack -p"</b></span>
},</pre>
<p>Now rebuild the project and note that Webpack has not emitted an app.js.map file. However, it will still be in your /build directory from the last build so delete it from there.</p>

<div class="ke-callout ke-callout-goal">
  <h4>Congratulations - Webpack, ESLint and Babel are all operational in you development environment!</h4>
  <p>There is much, much more these tools can do to make your everyday development experience better. Use the references listed below to start you exploration.</p>
</div>


<h2>List of commands</2>
<pre>$ npm list -g --depth=0</pre>
<pre>$ npm list --depth=0</pre>

<p>Switch between es5 and es6 change .eslintrc env:es6:true/false</p>

<h2>Production</h2>
<pre>webpack --config webpack.production.config.js -p</pre>

</div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="bootstrap/js/bootstrap.min.js"></script>


</div> <!-- containter-fluid -->
</body>
