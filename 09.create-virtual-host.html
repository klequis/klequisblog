<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>10. virtual host</title>
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="flint-style.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="dev-style.css">
</head>

<body>

<div class="container-fluid">
  <div class="ke-callout ke-callout-danger">
    <ul>
      <li>pending read out-loud</li>
      <li>pending spelling</li>
      <li>pending punctuation</li>
    </ul>
  </div>

  <div class="panel panel-default">
    <div class="panel-body">
      <p>You can have multiple websites on you development machine hosted by the single Apache instance. You have already seen the default virtual host when <a href="http://trivalleyhobby.com/klequis/?p=85&preview=true">Installing Apache 7</a>. For each site you want to create you need to create a <i>Virtual Host</i>.</p>

      <blockquote>
        <b>Virtual Host</b> - The term Virtual Host refers to the practice of running more than one web site (such as company1.example.com and company2.example.com) on a single machine. Virtual hosts can be "IP-based", meaning that you have a different IP address for every web site, or "name-based", meaning that you have multiple names running on each IP address. The fact that they are running on the same physical server is not apparent to the end user.
        <cite>The Apache Software Foundation</cite>
      </blockquote>
      <p>Follow the steps below to create a virtual host.</p>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Brief Explanation of Directory Structure</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <p>The 'sites-available' directory contains all the virtual hosts in your dev environment. Virtual hosts in /sites-available may or may not be enabled. To enable a virtual host the command <code>$ a2ensite</code> is used to create a symbolic link in /sites-enabled that points back to the virtual host (.conf file) in /sites-available. The /sites-enabled folder contains all the sites that are currently <i>enabled</i>. To create a virtual host, you first create a .conf file in /sites-available and then execute <code>$ a2ensite</code> to create the link to it in /sites-enabled.</p>
          <ol>
            <li>/sites-available contains all the virtual host files.</li>
            <li>/sites-enabled contains links to virtual host files in /sites-available. If a file in /sites-available is linked to /sites-enabled the site is enabled. If it is not linked, the site is not enabled.</li>
            <li>000-default.conf is the default site that was setup by the Apache installation.</li>
            <li>000-default.conf in /sites-enabled is a link to the file of the same name in /sites-available. You can tell it is a link by the first letter of its listing, 'l' in 'lrwxrwxrwx' means 'symbolic link'.</li>
          </ol>
        </div>
        <div class="col-md-4">
          pic.001
          <a href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/001.directorystructure.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/001.directorystructure.png" alt="apache directory structure" /></a>
        </div>

      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Create a folder for the site</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <p>First we will create a folder for all of your development websites called 'workspace' and then each site will have its own folder inside of 'workspace'.</p>
          <p>Create /workspace</p>
          <pre>$ cd ~<br>$ mkdir workspace</pre>
          <p>Now create a folder for the first website /workspace/helloworld</p>
          <pre>$ cd workspace<br>$ mkdir helloworld</pre>
          <p>So far we have created a folder for the site and a simple webpage. However, we can't navigate to the site until we complete the steps that follow</p>
        </div>
        <div class="col-md-4">

        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Create the Site</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <pre>$ cd helloworld<br>$ gedit index.html</pre>
          <p>Enter the text</p>
          <pre>&lt;h3&gt;Hello World&lt;/h3&gt;</pre>
          <p>Save and close the file.</p>
        </div>
        <div class="col-md-4">
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Allowing Apache to Serve Files from /home/workspace</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <p>There is one more bit of Apache configuration we need to do. This was not done in the post on installing Apache as you only need to make this change if you are creating your sites in a directory other than /var/www. Since we will be creating our sites in /home/workspace, we need to tell Apache it is OK to serve web pages from this location.</p>
          <p>Open apache2.conf.</p>
          <pre>$ sudo gedit /etc/apache2/apache2.conf</pre>
          <p>Look for "&lt;Directory /var/www/&gt;"</p>
          <p>Below the "&lt;Directory /var/www/&gt;" section, add another section as shown below, replacing <i>userName</i> with your user name.</p>
          <p>The picture shows the change. Be sure you used your user name and not mine.</p>
          <pre>&lt;Directory /home/<i>userName</i>/workspace&gt;<br>    Options Indexes FollowSymLinks<br>    AllowOverride All<br>    Require all granted<br>&lt;/Directory&gt;<br>ServerName localhost</pre>
        </div>
        <div class="col-md-4">
          pic.002
          <a
            href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/002.edit.apache2.conf.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/002.edit.apache2.conf.png" alt="editing apache2.conf" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Creating a Virtual Host</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <p>In Terminal, switch to the 'sites-available' directory.</p>
          <pre><code>$ cd /etc/apache2/sites-available</code></pre>
          <p>Create a new document named 'helloworld.conf'.</p>
          <pre><code>$ sudo gedit helloworld.conf</code></pre>
          <p>Make the contents of the file as below replacing <i>userName</i> with your user name.</p>
          <pre>&lt;VirtualHost *:80&gt;<br>  ServerName helloworld.localhost<br>  DocumentRoot /home/<i>userName</i>/workspace/helloworld<br>  &lt;Directory "/home/<i>userName</i>/workspace/helloworld"&gt;<br>    Options FollowSymLinks<br>    AllowOverride All<br>    Require all granted<br>  &lt;/Directory&gt;<br>&lt;/VirtualHost&gt;</pre>
          <p>The picture shows helloworld.conf with my user name.</p>

          <p class="ke-callout ke-callout-info">I'll show you how to copy helloworld.conf to create another virtual host at the end of this post.</p>
        </div>
        <div class="col-md-4">
          pic.003
          <a
            href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/003.helloworld.conf.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/003.helloworld.conf.png" alt="editing apache2.conf" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Create a domain entry for the new host/site</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">

          <pre><code>$ sudo -i gedit /etc/hosts</code></pre>
          Below the list of domains that starts with "127.0.0.1 localhost", enter the below line
          <pre><code>127.0.0.1    helloworld.localhost</code></pre>
          Save and close the hosts file
        </div>
        <div class="col-md-4">
          pic.004
          <a
            href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/004.editingecthosts.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/004.editingecthosts.png" alt="editing apache2.conf" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Enable the new site and restart Apache</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <pre>$ sudo a2ensite helloworld.conf<br>$ sudo systemctl restart apache2</pre>
        </div>
        <div class="col-md-4">
          pic.005
          <a
            href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/005.enable.helloworld.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/005.hellowworld.png" alt="editing apache2.conf" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>Launch the site</h2>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-8">
          <ol>
            <li>Open your browser</li>
            <li>In the address bar enter "helloworld.localhost"</li>
          </ol>
          <p>The page should appear as shown in the picture.</p>
        <div class="ke-callout ke-callout-warning">
          <h4>Forbidden?</h4>
          <p>Did you get an error page that said 'Forbidden'? I have struggled with this since my very first virtual host a long time ago and have never been able to figure out why it happens. If you know the solution please put it in a comment.</p>
          <p>The work-around is to <b>restart you virtual machine</b>. According to everything I have read you should not need to do this, but it works.</p>
        </div>
        <div class="col-md-4">
          pic.006
          <a
            href="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/006.index.html.png"><img class="img-responsive img-step-figure" src="http://trivalleyhobby.com/klequis/wp-content/uploads/2016/0619.create-virtual-host/006.index.html.png" alt="editing apache2.conf" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2>References</h2>
    </div>
    <div class="panel-body">
      <ol>
        <li><a href="https://httpd.apache.org/docs/current/vhosts/">, The Apache Software Foundation</a></li>
      </ol>
    </div>
  </div>



</div> <!-- containter-fluid -->



<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="bootstrap/js/bootstrap.min.js"></script>



</body>
